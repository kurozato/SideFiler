<mah:MetroWindow x:Class="BlackSugar.Views.ReadingListWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:mah="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro" 
        xmlns:views="clr-namespace:BlackSugar.Views"
        d:DataContext="{d:DesignInstance Type=views:ReadingListViewModel}"
        mc:Ignorable="d"
        Title="ReadingList" 
        TitleCharacterCasing="Normal"
        NonActiveWindowTitleBrush="{DynamicResource MahApps.Brushes.Accent2}"
        TitleForeground ="Transparent" 
        Height="600" Width="400">
    <mah:MetroWindow.LeftWindowCommands>
        <mah:WindowCommands>
            <WrapPanel VerticalAlignment="Center">
                <Image Source="/icon.ico" Width="20" Height="20" Margin="4 0 0 0" />
                <TextBlock VerticalAlignment="Center" Margin="6 0 12 0" FontSize="12" Text="{Binding Source={x:Static views:ResourceService.Current}, Path=Resources.ReadingList, Mode=OneWay}"></TextBlock>
            </WrapPanel>

        </mah:WindowCommands>
    </mah:MetroWindow.LeftWindowCommands>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="50" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="30" />
            </Grid.ColumnDefinitions>
            <Label Grid.Column="0">filter:</Label>
            <TextBox
                Style="{DynamicResource MaterialDesignTextBox}" 
                Grid.Column="1"
                Text="{Binding Filter}"
                ></TextBox>
            <Button
                Grid.Column="2"
                VerticalAlignment="Center"           
                Style="{DynamicResource MahApps.Styles.Button.Chromeless}" Cursor="Arrow"
                FontFamily="Segoe MDL2 Assets"
                Content="&#xE845;"
                Command="{Binding }"
                ToolTip="{Binding Source={x:Static views:ResourceService.Current}, Path=Resources.ClearFilter, Mode=OneWay}"/>

        </Grid>
        <ListBox
            Grid.Row="1"
            SelectionMode="Single"
            ItemsSource="{Binding ReadingLists, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            SelectedItem="{Binding Selected, Mode=OneWayToSource}"
            HorizontalContentAlignment="Stretch">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <StackPanel Margin="-3" 
                                        ToolTip="{Binding Path, Mode=OneWay}"
                                Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Window}}">
                        <DockPanel>
                            <TextBlock DockPanel.Dock="Left" FontWeight="Bold" Text="{Binding Name, Mode=OneWay}" />
                            <Button DockPanel.Dock="Right"
                                        Style="{DynamicResource MaterialDesignFlatButton}" Cursor="Arrow"
                                        FontFamily="Segoe MDL2 Assets"
                                        Content="&#xE711;"
                                        ToolTip="{Binding Source={x:Static views:ResourceService.Current}, Path=Resources.Delete, Mode=OneWay}"
                                        HorizontalAlignment="Right" VerticalAlignment="Center"
                                        Margin="0 0 0 0"
                                        Height="20"
                                        Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding DataContext,
                                            RelativeSource={RelativeSource
                                            Mode=FindAncestor,
                                            AncestorType=FrameworkElement,
                                            AncestorLevel=1}}"
                                        FontSize="8" />
                        </DockPanel>
                        <DockPanel>
                            <TextBlock Text="{Binding Path, Mode=OneWay}" FontWeight="Normal" Opacity="0.6" FontSize="11"/>
                        </DockPanel>
                        <StackPanel.ContextMenu>
                            <ContextMenu 
                                        FontSize="12" 
                                        Style="{DynamicResource MahApps.Styles.ContextMenu}" 
                                        BorderBrush="LightGray"
                                        DataContext="{Binding Path=PlacementTarget.Tag, RelativeSource={RelativeSource Self}}">
                                <MenuItem 
                                            Header="{Binding Source={x:Static views:ResourceService.Current}, Path=Resources.Delete, Mode=OneWay}" 
                                            Command="{Binding DeleteCommand}"/>
                            </ContextMenu>
                        </StackPanel.ContextMenu>
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Grid>
</mah:MetroWindow>
